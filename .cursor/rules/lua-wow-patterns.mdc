---
description: Lua coding patterns and best practices for WoW addon development
globs: "**/*.lua"
alwaysApply: false
---

# Lua WoW Addon Patterns

## Namespace

```lua
local ADDON_NAME, ns = ...
```

Use `ns` for inter-file communication. Expose one global table `PP` for the addon API.

## Localize Globals

Always localize frequently used globals at file scope:

```lua
local pairs, ipairs, type = pairs, ipairs, type
local tinsert, tremove, wipe = table.insert, table.remove, wipe
local floor, ceil, max, min = math.floor, math.ceil, math.max, math.min
local format = string.format
local CreateFrame, hooksecurefunc = CreateFrame, hooksecurefunc
local UnitName, UnitClass, UnitLevel = UnitName, UnitClass, UnitLevel
```

## Guard Against Zero/Nil

Always guard frame dimensions before division or SetScale:

```lua
local w, h = frame:GetSize()
if w == 0 or h == 0 then return end
```

## Events

Use a single event frame with dispatch table, not one frame per event:

```lua
local frame = CreateFrame("Frame")
local handlers = {}
frame:SetScript("OnEvent", function(self, event, ...)
    if handlers[event] then handlers[event](...) end
end)
```

## Performance

- Use `C_Timer.NewTicker()` instead of OnUpdate for periodic work
- Use event-driven updates, not polling
- Cache API results that don't change often
- Use `wipe(table)` instead of creating new tables
- Concatenate with `format()` or `table.concat()`, never `..` in loops

## Error Handling

Use `pcall`/`xpcall` around risky operations (tooltip parsing, item info that may not be cached).

## No Semicolons

WoW Lua convention: no trailing semicolons.
